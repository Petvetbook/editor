"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){var t=e.isNode,n=e.realm;RegExp.prototype.execAll=function(e){for(var t=null,n=new Array;t=this.exec(e);){var i=[];for(var r in t)parseInt(r)==r&&i.push(t[r]);n.push(i)}return n},n.module("morrr.editor.utils.lodash",function(){return t?require("lodash"):window._}),t&&require("image-server-client"),n.module("frzr",function(){return t?{}:window.frzr}),n.module("morrr.editor.utils.Promise",function(){return t?require("promise"):window.Promise}),n.module("morrr.editor.utils.sharedImagePath",["morrr.editor.runtime.config"],function(e){return function(t,n){return e.server+"/"+e.folder+"/"+t+"?&height="+(n||400)+"&quality=80"}}),n.module("morrr.editor.Engine",["morrr.editor.bbcode.BBCodeEngine","morrr.editor.bbcode.Generator","morrr.editor.bbcode.BBCodeExtractor","morrr.editor.bbcode.BBCodeHandlers","morrr.editor.utils.lodash","morrr.editor.utils","morrr.editor.Modal"],function(e,t,n,i,r,o,a){var s,c=function(){function n(){_classCallCheck(this,n)}return _createClass(n,[{key:"initialize",value:function(e,t){this.opts=t||{},this.tags={},this.toolbarConfig=t.toolbar||[],this.element=$('<div class="sane-editor"></div>'),this.formattingWrapper=$('<div class="sane-formatting-toolbar-wrapper"></div>'),this.toolbarWrapper=$('<div class="sane-editor-toolbar-wrapper"></div>'),this.toolbarWrapper.appendTo(this.element),this.toolbar=$('<div class="sane-formatting-toolbar"></div>'),this.toolbar.appendTo(this.formattingWrapper),this.modalWrapper=$('<div class="sane-editor-modal-wrapper"></div>'),this.modalWrapper.appendTo(this.element),this.contentAreaWrapper=$('<div class="sane-editor-content-area-wrapper"></div>'),this.contentWrapper=$('<div class="sane-editor-content-wrapper"></div>'),this.leftMenu=$('<div class="sane-editor-left-menu"></div>'),this.element.append(this.leftMenu),this.element.append(this.contentPane),this.formattingWrapper.appendTo(this.contentAreaWrapper),this.contentWrapper.appendTo(this.contentAreaWrapper),this.contentAreaWrapper.appendTo(this.element),this.content=$('<div class="sane-editor-content" contenteditable="true"></div>'),this.content.appendTo(this.contentWrapper),this.contentPane=$('<div class="sane-editor-content-pane"></div>'),this.contentPane.hide(),this.contentPane.appendTo(this.contentWrapper),e.replaceWith(this.element),this.inializeToolbar(),this.fixCloningFeature();var n=this;this.setValue(""),$(this.content).bind("paste",function(e){var t=($(e.currentTarget),e.originalEvent.clipboardData.getData("Text")),i=o.trimText(t);e.originalEvent.preventDefault(),n.execCommand("insertHTML",!1,"<x></x><div>"+i+"</div>")}),this.hideEditor(),this.toggleFullScreenMode()}},{key:"mountToolbar",value:function(e,t){var n=this.menuToolbar;n||(this.menuToolbar=$("<div class='main-toolbar'></div>"),this.menuToolbar.appendTo(this.toolbarWrapper),n=this.menuToolbar);var i=riot.mount(n[0],e,t||{});return this.tags.mainToolbar=i?i[0]:void 0,this.tags.mainToolbar}},{key:"mountFileToolbar",value:function(e,t){var n=this.fileToolbar;n||(this.fileToolbar=$("<div class='sane-file-toolbar-wrapper'></div>"),this.fileToolbar.appendTo(this.contentWrapper),n=this.fileToolbar);var i=riot.mount(n[0],e,t||{});return this.tags.fileToolbar=i?i[0]:void 0,this.tags.fileToolbar}},{key:"mountLanguageToolbar",value:function(e,t){var n=this.langToolbar;n||(this.langToolbar=$("<div class='sane-language-toolbar-wrapper'></div>"),this.langToolbar.prependTo(this.contentAreaWrapper),n=this.langToolbar);var i=riot.mount(n[0],e,t||{});return this.tags.langToolbar=i?i[0]:void 0,this.tags.langToolbar}},{key:"update",value:function(e){var t=this;clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(function(){r.each(t.tags,function(e){e&&e.update&&e.update()})},1)}},{key:"openContentPane",value:function(){var e=this;this.content.fadeOut(function(){e.contentPane.fadeIn()})}},{key:"closeContentPane",value:function(){var e=this;this.contentPane.fadeOut(function(){e.content.fadeIn()})}},{key:"onActivity",value:function(e){this.activity_cb=e}},{key:"triggerActivity",value:function(){var e=this;this.activity_cb&&(clearTimeout(this.updateTyping),this.updateTyping=setTimeout(function(){e.activity_cb()},50))}},{key:"getValue",value:function(){return this.$value=this.generate(),this.$value}},{key:"getHeadings",value:function(){}},{key:"generate",value:function(){return t(this)}},{key:"toolbarIconClick",value:function(e){var t=this;if(t.triggerActivity(),r.isFunction(e)){var n=t.getRange();if(n){var i,o=n.commonAncestorContainer,a=$(o).parent(),s=$(o).parents(".sane-editor-content");s[0]?(a.hasClass("content")&&(i=o),e.apply(t,[i,a,n])):e.apply(t,[null,null,n])}}}},{key:"hideEditor",value:function(){$(this.content).hide(),$(this.formattingWrapper).hide()}},{key:"showEditor",value:function(){$(this.content).show(),$(this.formattingWrapper).show()}},{key:"showError",value:function(e){this.element.find(".notification").remove();var t=$('<div class="notification"><div class="text">'+e+"</div></div>");t.insertBefore(this.content),t.addClass("show"),setTimeout(function(){t.removeClass("show")},1500)}},{key:"createModal",value:function(e){var t=a.create({title:e,target:this.modalWrapper});return t}},{key:"onFullScreenLeftMenu",value:function(e){this._onFullScreenLeftMenu=e}},{key:"smartRangeDetect",value:function(e){var t=this;return new Promise(function(n,i){var o=t.getRange();if(o){var a=[],s=0,c=o.endContainer.innerHTML||o.endContainer.nodeValue,l=!1,d=function(e){if(e){var t=$(e).parents(".sane-editor-content")[0],n=$(e).parents(".wrapper-editable-area")[0];if(!t)throw{message:"Your selection should be within editor area!"};if($(e).parents(".wrapper")[0]||n)throw{message:"You can't use text within formatted blocks"}}if(void 0==e)return!1;var i=!1,r=e.nodeValue||e.innerHTML;return void 0!==r&&(i=r===c,l||a.push(e),!l&&i&&(l=!0)),i},u=function g(e){if(d(e))return a;for(;e;){var e=e.nextSibling;if(d(e))return e=null,a;if(!l&&e&&e.childNodes.length&&g(e.childNodes[0]),s++,s>100)return a}return e},f=o.startContainer;if(3===o.startContainer.nodeType&&1===o.startContainer.parentNode.childNodes.length){f=o.startContainer.parentNode;var h=o.endContainer.nodeValue||o.endContainer.innerHTML,v=o.startContainer.nodeValue||o.startContainer.innerHTML;h===v&&(a=[o.endContainer.nodeValue?o.endContainer.parentNode:o.endContainer])}var m=[],p=[];return 0===a.length?(u(f),r.each(a,function(e){e.childNodes&&0!==e.childNodes.length?e.childNodes&&1===e.childNodes.length&&(p.push(e),m.push($(e).text())):(p.push(e),m.push($(e).text()))})):r.each(a,function(e){p.push(e),m.push($(e).text())}),e.apply(t,[{range:o,text:m,elements:p,inject:function(e){t.triggerActivity();var n=$(o.endContainer);if(n.parent(".sane-editor-content")[0]||$(o.endContainer).hasClass("sane-editor-content"))console.log("yes here...."),o.insertNode(e);else{for(var i,r=!1,a=n.parent(),s=0;!r&&50>s;)a.hasClass("sane-editor-content")?r=!0:(i=a,a=a.parent()),s++;r&&i[0]&&$(e).insertBefore(i)}}}])}t.showError("You need to select something")})}},{key:"inializeToolbar",value:function(){var e=this;r.each(this.toolbarConfig,function(t){var n=i[t];if(n){var r=$('<div class="button"><span>'+n.hint+"</span></div>");r.addClass(n.icon),$(e.toolbar).append(r),r.mousedown(function(e){e.preventDefault()}),r.click(function(t){n.cmd?e.toolbarIconClick(n.cmd):"",n.cmdSmart&&e.smartRangeDetect(n.cmdSmart).then(function(){})["catch"](function(t){e.showError(t.message)}),e.triggerActivity()})}});var t=$('<div class="button maximize"><span>Toggle fullscreen</span></div>');t.appendTo($(e.toolbar)),t.click(function(){e.toggleFullScreenMode()})}},{key:"basicStringWrapper",value:function(e,t){if(!$(e).parents(".wrapper")[0]){t=t||{};var n="wrapper",i="";t.service&&(n+=" sane-editor-service",i=' data-service="'+t.service+'" ');var o=['<div class="'+n+'" '+i+' contenteditable="false">'];o.push('<div class="user-controls">'),o.push('<i class="ui icon remove"></i>'),o.push("</div>"),o.push('<div class="user-content">'),o.push("</div>"),o.push("</div>");var a=$(o.join("")),s=$(e).clone();a.find(".user-content").append(s);var c=s.html();return s.empty(),s.append("<div class='wrapper-editable-area' contenteditable='true'>"+c+"</div>"),$(e).replaceWith(a),a.find(".remove").click(function(){r.isFunction(t.onRemove)&&t.onRemove(a)}),{element:a}}}},{key:"basicModuleWrapper",value:function(e,t){if(!$(e).parents(".wrapper")[0]){t=t||{};var n="wrapper",i="";t.service&&(n+=" sane-editor-service",i=' data-service="'+t.service+'" ');var o=['<div class="'+n+'" '+i+' contenteditable="false">'];o.push('<div class="user-controls">'),o.push('<i class="ui icon remove"></i>'),o.push("</div>"),o.push('<div class="user-content">'),o.push("</div>"),o.push("</div>");var a=$(o.join("")),s=$(e).clone();return a.find(".user-content").append(s),$(e).replaceWith(a),a.find(".remove").click(function(){r.isFunction(t.onRemove)&&t.onRemove(a)}),t.onReady&&t.onReady(a[0]),{element:a}}}},{key:"setValue",value:function(t){this.content.empty(),e.toEditor("<x></x>"+t+"<x></x>",this)}},{key:"getSelection",value:function(e){return e=e||{},e.focus!==!1&&this.content[0].focus(),window.getSelection()}},{key:"getRange",value:function(e){var t=this.getSelection(e);if(!t)return null;if(t.getRangeAt&&t.rangeCount>0){var n=t.getRangeAt(0);return n}if(t.createRange){var i=t.createRange();return i}return null}},{key:"execCommand",value:function(e,t,n){this.triggerActivity(),this.content.focus(),document.execCommand(e,t||!1,n||null)}},{key:"setCaretPosition",value:function(e,t){var n=document.createRange(),i=window.getSelection();n.setStart(e,1),n.collapse(!0),i.removeAllRanges(),i.addRange(n),setTimeout(function(){$(e).remove()},0)}},{key:"bindFullScreenButtons",value:function(){var e=this;this.floatingSave=$('<div class="floating button save"></div>'),this.floatingPreview=$('<div class="floating button preview"></div>'),this.floatingPreview.click(function(){e.onFloatingPreview&&e.onFloatingPreview()}),e.exitFullScreenModeButton=$('<div class="floating button exit"></div>'),e.exitFullScreenModeButton.click(function(){e.toggleFullScreenMode()}),this.floatingSave.click(function(){e.onFloatingSave&&(e.onFloatingSave(),e.floatingSave.removeClass("primary").addClass("green"),e.floatingSave.find("i").removeClass("save").addClass("checkmark"),e.floatingSave.animate({zoom:1.2},{duration:100,complete:function(){e.floatingSave.animate({zoom:1},{duration:100,complete:function(){setTimeout(function(){e.floatingSave.removeClass("green").addClass("primary"),e.floatingSave.find("i").removeClass("checkmark").addClass("save")},500)}})}}))}),this.element.append(this.floatingSave),this.element.append(this.floatingPreview),this.element.append(e.exitFullScreenModeButton)}},{key:"toggleFullScreenMode",value:function(){var e=this;if($(this.element).hasClass("full-screen-mode"))$(this.element).removeClass("full-screen-mode"),$("body").css("overflow","auto"),$(this.element).find(".left-menu").remove();else if($("body").css("overflow","hidden"),$(this.element).addClass("full-screen-mode"),e._onFullScreenLeftMenu){var t=$("<div class='left-menu' style='color:white'></div>");$(this.element).find(".sane-editor-content-wrapper").append(t),e._onFullScreenLeftMenu(t)}}},{key:"fixCloningFeature",value:function(){var e=this;$(this.content).bind("keydown",function(t){e.triggerActivity(),tabPressed=!1;var n=e.getRange({focus:!1});if(n){var i=$(n.commonAncestorContainer),o=i.parents(".wrapper");if(o.hasClass("capture-keyboard-interaction")){var a=$("<div></br></div>");return a.insertAfter(o),void e.setCaretPosition(a[0],1)}if(13===t.keyCode&&o[0]){3===i[0].nodeType&&(i=i.parent());var s=""===$(i).text(),c=0,l=[];i.prevAll().each(function(){l.push(this)}),l.reverse();var d=[];if(r.each(l,function(e){""===$(e).text()?(c++,d.push(e)):(d=[],c=0)}),s&&(d.push(i),c++),2===c){if(d.length>0){var u=d[d.length-1];u&&$(u).nextAll().insertAfter(o)}r.each(d,function(e){$(e).remove()});var a=$("<div></br></div>");a.insertAfter(o),e.setCaretPosition(a[0],1)}}}})}}]),n}();return s=c}),n.module("morrr.editor.Gallery",["morrr.editor.utils.lodash","morrr.editor.utils.sharedImagePath","frzr"],function(e,t,n){var i,r=function(n,i,r){i=i||"";var o=n.createModal("Insert image"),a=$('<div class="images"></div>'),s=$('<div class="multiupload"></div>');$('<div class="actions"><div class="button cancel">Cancel</div><div class="ui button primary okay">Insert</div></div>');o.append(s),o.append(a);var c=[],l=$('<div class="image"><div class="active large inline loader image-loader"></div></div>'),d=function(){a.empty(),$.get("/api/editor/images?parent="+i,function(n){var i;e.each(n,function(n){var r=$('<div class="image"><img src="'+t(n.image,120)+'"/></div>');r.appendTo(a),r.data("item",n),i={item:n,image:r},r.click(function(){var t=$(this).data("item");if(e.indexOf(c,t.image)>-1){e.remove(c,function(e){return t.image===e}),r.removeClass("selected")}else c.push(t.image),r.addClass("selected");0===c.length?o.disableSuccess():o.enableSuccess()})}),i&&(i.image.addClass("selected"),c.push(i.item.image))})};d(),o.onSuccess(function(){r(c),o.close()}),s.uploadFile({url:"/api/editor/upload?parentId="+i,multiple:!0,fileName:"myfile",showProgress:!0,onSubmit:function(e,t){a.append(l)},afterUploadAll:function(){l.remove(),$.get("/api/editor/images",{parent:i},function(){d()})}})};return i=r}),n.module("morrr.editor.Modal",["frzr"],function(e){var t,n=1e3,i=0,r=e.el,o=function(){function e(t){_classCallCheck(this,e);var o=this;t=t||{};var a=t.target||document.body;this.header=r("div",{"class":"header",textContent:t.title||"opts.title"}),this.successButton=r("div",{"class":"button success"}),this.closeButton=r("div",{"class":"button close"}),$(this.closeButton).click(function(){o.close()}),this.footer=r("div",{"class":"footer"},[this.closeButton,this.successButton]),this.content=r("div",{"class":"content"}),this.modal=r("div",{"class":"modal",style:"z-index:"+n++},[this.header,this.content,this.footer]),$(a).prepend(this.modal),i++}return _createClass(e,[{key:"close",value:function(){i--,$(this.modal).remove()}},{key:"append",value:function(e){$(this.content).append(e)}},{key:"onSuccess",value:function(e){var t=this;$(this.successButton).click(function(){t.saveLock||e()})}},{key:"disableSuccess",value:function(){$(this.successButton).hasClass("disabled")||$(this.successButton).addClass("disabled"),this.saveLock=!0}},{key:"enableSuccess",value:function(){$(this.successButton).removeClass("disabled"),this.saveLock=!1}}],[{key:"create",value:function(t){var n=new e(t);return n}}]),e}();return t=o}),n.module("morrr.editor.utils",["morrr.editor.utils.lodash"],function(e){var t,n=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"stringInject",value:function(e,t,n,i){return e.slice(0,t)+i+e.slice(t+Math.abs(n))}},{key:"trimText",value:function(e,t){return e=e.replace(new RegExp(String.fromCharCode(160),"g")," "),e=e.replace(/\s+/g," "),t&&(e=e.trim()),e}},{key:"replaceEmptyLines",value:function(t){var n=t.split(/\n/),i=[];return e.each(n,function(e,t){e.length>0&&!e.match(/^\s+$/)&&(0!==t||"[/br]"!==e)&&i.push(e)}),i.join("\n")}},{key:"cleanUpItems",value:function(n){var i=n.match(/(\[\w+\]\s*\[\/\w+\])/gi);return e.each(i,function(e){n=n.split(e).join("")}),n=i&&i.length>0?t.cleanUpItems(n):t.replaceEmptyLines(n)}},{key:"flattenNodes",value:function n(e,t){var i=document.createElement("div"),r=i,n=function o(e,t){for(var n=0;n<=e.length;n++){var a=e[n];if(a)if("BR"===a.nodeName)i.appendChild(document.createElement("div"));else{var s=a.className&&a.className.indexOf("wrapper")>-1;if("DIV"===a.nodeName&&!s){var c=i.childNodes[i.childNodes.length-1],l=!1;c&&(l=c.innerHTML.match(/^\s+$/g)),r=document.createElement("div"),i.appendChild(r)}a.className&&s?(i.appendChild(a),r=document.createElement("div"),i.appendChild(r),n--):a.childNodes&&a.childNodes.length?o(a.childNodes,!0):(3===a.nodeType&&(r===i&&(r=document.createElement("div"),i.appendChild(r)),a.nodeValue=a.nodeValue),r.appendChild(a),n--)}}};return n(t),i}}]),t}();return t=n}),n.module("morrr.editor.runtime.config",["morrr.editor.utils.Promise"],function(e){var t,i=new e(function(e,t){return n.isRegistered("morrr.editor.config")?n.require("morrr.editor.config",function(e){return e}).then(e)["catch"](t):e({token:"c0b7bdf9b9f645f9f7b106d41082f50d14726129",server:"http://img.dev.morrr.com",folder:"editortest",fullPath:function(e){return this.server+"/"+e}})});return t=i}),n.module("morrr.editor.elements.b",["morrr.editor.utils"],function(e){var t,n={tag:"b",inline:!0,toBBCode:function(t){t.find("b").each(function(t,n){$(n).replaceWith("[strong]"+e.trimText($(n).text())+"[/strong]")})}};return t=n}),n.module("morrr.editor.elements.blockquote",["morrr.editor.utils"],function(e){var t,n={index:1,tag:"blockquote",menu:!0,hint:"Quote",icon:"quote",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"blockquote",onRemove:function(e){e.replaceWith("<div>"+e.find("blockquote").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="blockquote"]').each(function(t,n){var i=$(n).find(".wrapper-editable-area").text();$(n).replaceWith("[blockquote]"+e.trimText(i)+"[/blockquote]")})},cmdSmart:function(e){var t=$("<blockquote>"+e.text.join(" ")+"</blockquote>");$(e.elements).remove(),e.inject(t[0]),n.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return"<blockquote>"}};return t=n}),n.module("morrr.editor.elements.gallery",["morrr.editor.Gallery","morrr.editor.utils.lodash","morrr.editor.utils.sharedImagePath"],function(e,t,n){var i,r={tag:"div",hint:"Insert images",icon:"picture",cmdSmart:function(i){var o=this;e(this,this.parentId,function(e){var a=['<div class="blog-gallery">'];t.each(e,function(e){a.push('<figure data-id="'+e+'"><img src="'+n(e)+'"></figure>')}),a.push("</div>");var s=$(a.join(""))[0];i.inject(s),r.bindEditorEvents.bind(o)(s),o.triggerActivity()})},_bindFigure:function(e,t){var n=$('<i class="ui icon remove"></i>'),i=$(t).find("figcaption")[0],r=$('<figcaption><input type="text" placeholder="Image description" class="figcontent"></input></figcaption>');if(i){var o=$(i).text();r.find(".figcontent").val(o),$(i).replaceWith(r)}else i=r,$(t).append(i);n.appendTo(t),n.click(function(){$(e).find("figure").length<=1?$(e).fadeOut(function(){$(this).remove()}):$(this).parent("figure").fadeOut(function(){$(this).remove()})})},bindEditorEvents:function(i){var o=this,a=o.parentId;this.basicModuleWrapper(i,{service:"gallery",onReady:function(i){var s=$('<div class="floating button placeholder"></div>');s.appendTo($(i).find(".blog-gallery")),s.click(function(){e(o,a,function(e){t.each(e,function(e){var t=$('<figure data-id="'+e+'"><img src="'+n(e)+'"/></figure>');t.insertBefore(s),r._bindFigure(i,t)})})}),$(i).find(".user-controls .remove").click(function(){$(i).remove()}),$(i).find("figure").each(function(e,t){r._bindFigure(i,t)})}})},toBBCode:function(e){e.find('*[data-service="gallery"]').each(function(e,t){var n=["[gallery]"];$(t).find("figure").each(function(e,t){var i=['id="'+$(t).data("id")+'"'],r=$(t).find("figcaption .figcontent");r[0]&&r.val()&&i.push('caption="'+r.val()+'"'),n.push("[img "+i.join(" ")+'"][/img]')}),n.push("[/gallery]"),$(t).replaceWith(n.join(""))})},toProduction:function(e){return'<div class="blog-gallery">'}};return i=r}),n.module("morrr.editor.elements.h1",["morrr.editor.utils"],function(e){var t,n={tag:"h1",icon:"header1",hint:"Heading 1",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"h1",onRemove:function(e){e.replaceWith("<div>"+e.find(".wrapper-editable-area").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="h1"]').each(function(t,n){var i=$(n).find(".wrapper-editable-area").text();$(n).replaceWith("[h1]"+e.trimText(i)+"[/h1]")})},cmdSmart:function(e){var t=$("<h1>"+e.text.join(" ")+"</h1>");$(e.elements).remove(),e.inject(t[0]),n.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return"<h1>"}};return t=n}),n.module("morrr.editor.elements.h3",["morrr.editor.utils"],function(e){var t,n={tag:"h3",icon:"header3",hint:"Heading 3",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"h3",onRemove:function(e){e.replaceWith("<div>"+e.find(".wrapper-editable-area").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="h3"]').each(function(t,n){var i=$(n).find(".wrapper-editable-area").text();$(n).replaceWith("[h3]"+e.trimText(i)+"[/h3]")})},cmdSmart:function(e){var t=$("<h3>"+e.text.join(" ")+"</h3>");$(e.elements).remove(),e.inject(t[0]),n.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return"<h3>"}};return t=n}),n.module("morrr.editor.elements.i",[],function(){var e,t={tag:"i",menu:!1,inline:!0,icon:"italic",hint:"Italic",toBBCode:function(e){e.find("i").each(function(e,t){$(t).replaceWith("[i]"+$(t).text()+"[/i]")})},cmd:function(){this.execCommand("italic")}};return e=t}),n.module("morrr.editor.elements.img",["morrr.editor.utils.lodash","morrr.editor.utils.sharedImagePath"],function(e,t){var n,i={tag:"figure",menu:!1,toProduction:function(n,i){i=i||{};var r=i.imageTitle,o=i.query,a=[];e.each(o,function(e,t){0===t.indexOf("img")&&a.push(t.split("img-")[1]+"="+e)}),a=a.join("&");var s=t(n.attrs.id)+(a?"?"+a:""),c='<figure data-id="'+n.attrs.id+'"><img '+(r?'alt="'+r+'" ':"")+'src="'+s+'">';return n.attrs.caption&&(c+="<figcaption>"+n.attrs.caption+"</figcaption>"),c}};return n=i}),n.module("morrr.editor.elements.innerad",[],function(){var e,t={tag:"div",menu:!1,toBBCode:function(e){},toProduction:function(e,t){var n=e.attrs,i=['<span class="recommended">'+n.caption+'</span><div class="blog-item"><a href="'+n.link+'"><figure class="profile-image">'];return i.push('<img src="'+n.img+'?width=525&height=450&mode=crop&quality=60"></img>'),i.push("<figcaption>"),i.push(' <span class="category" style="background-color: '+n.catcolor+';">'+n.catname+"</span>"),i.push('<h2 class="title">'+n.title+"</h2>"),i.push("</figcaption></figure></a></div>"),'<div class="blog-list article-inline-promo hide-desktop">'+i.join("")}};return e=t}),n.module("morrr.editor.elements.intro",["morrr.editor.utils"],function(e){var t,n={tag:"div",menu:!0,stringWrapper:!0,icon:"intro",hint:"Intro paragraph",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"intro",onRemove:function(e){e.replaceWith("<div>"+e.find(".wrapper-editable-area").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="intro"]').each(function(t,n){var i=$(n).find(".wrapper-editable-area").text();$(n).replaceWith("[intro]"+e.trimText(i)+"[/intro]")})},cmdSmart:function(e){var t=$('<div class="blog-intro">'+e.text.join(" ")+"</div>");$(e.elements).remove(),e.inject(t[0]),n.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return'<div class="blog-intro">'},processAfterRender:function(e,t,n){return e}};return t=n}),n.module("morrr.editor.elements.li",[],function(){var e,t={tag:"li",inline:!0,toBBCode:function(e){for(;e.find("li").length>0;)e.find("li").each(function(e,t){$(t).replaceWith("[li]"+$(t).html()+"[/li]")})}};return e=t}),n.module("morrr.editor.elements.list",[],function(){var e,t={tag:"li",menu:!1,inline:!0,toBBCode:function(e){e.find("li").each(function(e,t){$(t).replaceWith("[li]"+$(t).html()+"[/li]")})}};return e=t}),n.module("morrr.editor.elements.ol",[],function(){var e,t={tag:"ol",menu:!0,inline:!0,icon:"ordered-list",hint:"Numbered list",toBBCode:function(e){e.find("ol").each(function(e,t){$(t).replaceWith("[ol]"+$(t).html()+"[/ol]")})},cmd:function(){this.execCommand("insertorderedlist")},toProduction:function(e){return"<ol>"}};return e=t}),n.module("morrr.editor.elements.panorama",[],function(){var e,t={tag:"div",menu:!1,toBBCode:function(e){},toProduction:function(e,t){return'<div class="article-inline-ad hide-desktop">'}};return e=t}),n.module("morrr.editor.elements.strong",["morrr.editor.utils"],function(e){var t,n={tag:"strong",menu:!1,inline:!0,icon:"bold",hint:"Bold",toBBCode:function(t){t.find("strong,b").each(function(t,n){$(n).replaceWith("[strong]"+e.trimText($(n).text())+"[/strong]")})},cmd:function(){this.execCommand("bold")}};return t=n}),n.module("morrr.editor.elements.ul",[],function(){var e,t={tag:"ul",menu:!0,inline:!0,icon:"unordered-list",hint:"Bulleted list",toBBCode:function(e){for(;e.find("ul").length>0;)e.find("ul").each(function(e,t){$(t).replaceWith("[ul]"+$(t).html()+"[/ul]")})},cmd:function(){this.execCommand("insertunorderedlist")},toProduction:function(e){return"<ul>"}};return e=t}),n.module("morrr.editor.elements.unlink",[],function(){var e,t={menu:!0,inline:!0,icon:"unlink",hint:"Remove link",cmd:function(){this.execCommand("unlink",!1,[])}};return e=t}),n.module("morrr.editor.elements.url",[],function(){var e,t={tag:"a",menu:!0,inline:!0,icon:"link",hint:"Insert link",toBBCode:function(e){e.find("a").each(function(e,t){$(t).replaceWith("[url="+$(t).attr("href")+"]"+$(t).text()+"[/url]")})},cmd:function(){var e=prompt("Please specify the link.");e&&this.execCommand("createLink",!1,e)},toProduction:function(e){var t=e.attrs.self;return t=t.replace(/\sp=.*/,""),-1===t.indexOf("http")&&(t="http://"+t),'<a target="_blank" href="'+t+'">'}};return e=t}),n.module("morrr.editor.bbcode.AttributeParser",[],function(){var e,t=function(e){if(!e)return{};if("="===e[0])return{self:e.slice(1,e.length)};var t,n=!0,i=!1,r={},o="",a="",s=!1;for(var c in e){var l=e[c];"="===l&&(n=!1,r[o]="",i=!0),n&&l.match(/[a-z0-9_]/i)&&(o+=l),i&&(t?l!==t||s?"\\"!==l||s?(a+=l,s=!1):s=!0:(i=!1,n=!0,r[o]=a,t=!1,o="",a=""):l.match(/'|"/)&&(t=l))}return r};return e=t}),n.module("morrr.editor.bbcode.BBCodeEngine",["morrr.editor.bbcode.BBCodeExtractor","morrr.editor.utils.lodash","morrr.editor.bbcode.BBCodeHandlers","morrr.editor.utils"],function(e,t,n,i){var r,o={replaceEndTags:function(e){return t.each(n,function(t,n){t.tag&&(e=e.split("[/"+n+"]").join("</"+t.tag+">"))}),e},_injectSystemId:function(e,t){return e=i.stringInject(e,e.length-1,0,' id="'+t+'"')},_prepareInput:function(e){return e=e.replace(/\[row\]/g,"<div>"),e=e.replace(/\[\/row\]/g,"</div>"),e=e.replace(/\[\/br\]/g,"<div><br></div>"),e=this.replaceEndTags(e)},toProduction:function(i,r){r=r||{},i=this._prepareInput(i);var o=e(i);i=o.input;var a=o.codes;return t.each(a,function(e){var n,o;(n=$BBCodeHandlers[e.name])&&(o=t.isFunction(n.toProduction)?n.toProduction(e,r):"<"+n.tag+">",i=i.replace(e.str,o))}),t.each(a,function(e){var o,a;(o=n[e.name])&&t.isFunction(o.processAfterRender)&&(a=o.processAfterRender(i,e,r))}),i},toEditor:function(i,r){i=this._prepareInput(i);var o=e(i),a=this;i=o.input;var s=o.codes,c={};t.each(s,function(e){var r,o;if(r=n[e.name]){if(o=t.isFunction(r.toProduction)?r.toProduction(e):"<"+r.tag+">",t.isFunction(r.bindEditorEvents)){var s="sane-element-"+e.attrs.p;o=a._injectSystemId(o,s),c[e.name]=c[e.name]||[],c[e.name].push(s)}i=i.replace(e.str,o)}});var l=$(i);r.content.append(l),t.each(c,function(e,i){t.each(e,function(e){var t=r.content.find("#"+e)[0];n[i].bindEditorEvents.apply(r,[t])})})}};return r=o}),n.module("morrr.editor.bbcode.BBCodeExtractor",["morrr.editor.bbcode.AttributeParser","morrr.editor.utils"],function(e,t){var n,i=function(n){for(var i=1,r=!1,o=!1,a=0;a<n.length;a++){var s=n[a];if("/"===s&&(r=!1),r){if(o&&"]"===s){var c=' p="'+i++ +'"';n=t.stringInject(n,a,0,c),a+=c.length-1,o=!1,r=!1}s.match(/[a-z0-9_]/i)&&(o=!0)}"["===s&&(r=!0)}var l=/\[([a-z0-9]+)\s?([^\]]+)?]/gim,d=l.execAll(n),u=[];return _.each(d,function(t){u.push({str:t[0],name:t[1],attrs:e(t[2])})}),{input:n,codes:u}};return n=i}),n.module("morrr.editor.bbcode.BBCodeHandlers",["morrr.editor.utils.Promise","morrr.editor.utils.lodash"],function(e,t){var i,r=n.requirePackage("morrr.editor.elements").then(function(e){var n={};return t.each(e,function(e,t){n[t.substring(22,t.length)]=e}),n});return i=r}),n.module("morrr.editor.bbcode.Generator",["morrr.editor.utils","morrr.editor.bbcode.BBCodeHandlers","morrr.editor.utils.lodash"],function(e,t,n){var i,r=function(i){var r=i.content.clone();n.each(t,function(e){e.toBBCode&&e.inline&&e.toBBCode.bind(i)(r)});var o=e.flattenNodes(i,r[0].childNodes);n.each(t,function(e){e.toBBCode&&!e.inline&&e.toBBCode.bind(i)($(o))});for(var a,s=[],c=!1,l=0;l<=o.childNodes.length;l++){var d=o.childNodes[l];if(d&&"X"!==d.nodeName){if(3===d.nodeType)if(d.nodeValue.match(/\[\S+\]/)){var u=e.trimText(d.nodeValue),f=u.match(/^\[(blockquote|gallery|intro|h3|h1)/);if(s.push(u),f&&(c=!0,a)){var h=s[a];"[/br]"===h&&s.splice(a,1)}}else s.push("[row]"+e.trimText(d.nodeValue,!0)+"[/row]");if(1===d.nodeType){var u=e.trimText($(d).text(),!0),v=""===u.replace(/\[\/?[^\]]+(\]|$)/g,"");v&&(u=""),u.length>0&&(a=null,c=!1),c||(0===u.length?(s.push("[/br]"),a=s.length-1):s.push("[row]"+u+"[/row]")),c=!u}}}var m=e.cleanUpItems(s.join("\n"));return m};return i=r})}(function(e){var t="undefined"!=typeof exports;return{isNode:t,realm:t?require("realm-js"):window.realm}}());