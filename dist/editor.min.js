"undefined"==typeof exports&&!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.frzr=e.frzr||{})}(this,function(e){"use strict";function t(e){return document.createTextNode(e)}function r(e){if(h){var t=h[e];if(t)return t.apply(this,arguments)}for(var r=document.createElement(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i&&!u(r,i)&&"object"==typeof i)for(var o in i){if(m){var a=m[o];if(a){a(r,i[o]);continue}}var s=i[o];"style"===o||null==r[o]&&"function"!=typeof s?r.setAttribute(o,s):r[o]=s}}return r}function n(e,t){h||(h={}),h[e]=t}function i(e,t){m||(m={}),m[e]=t}function o(e){h&&h[e]&&delete h[e]}function a(e){m&&m[e]&&delete m[e]}function s(e){for(var t=document.createElementNS("http://www.w3.org/2000/svg",e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n&&!u(t,n)&&"object"==typeof n)for(var i in n)t.setAttribute(i,n[i])}return t}function l(e,t,r,n){return new d(e,t,r,n)}function d(e,t,r,n){this.View=e,this.views=[],this.initData=r,this.skipRender=n,t&&(this.key=t,this.lookup={})}function u(e,t,r){var n=e.el||e,i=t.el||t,o=null!=i.parentNode;if(o?t.remounting&&t.remounting():t.mounting&&t.mounting(),i instanceof Node){if(r){var a=r;n.insertBefore(i,a)}else n.appendChild(i);o?t.remounted&&t.remounted():t.mounted&&t.mounted(),i!==t&&(i.view=t,t.parent=e)}else if("string"==typeof i||"number"==typeof i)u(n,document.createTextNode(i),r);else if(i instanceof Array)for(var s=0;s<i.length;s++)u(n,i[s],r);else{if(!(t instanceof d))return!1;t.parent=e,p(n,t.views)}return!0}function c(e,t,r){var n=e.el||e,i=t.el||t,o=r.el||r,a=null!=i.parentNode;r.unmounting&&r.unmounting(),a?t.remounting&&t.remounting():t.mounting&&t.mounting(),n.replaceChild(i,o),r.unmounted&&r.unmounted(),o!==r&&(r.parent=null),a?t.remounted&&t.remounted():t.mounted&&t.mounted(),i!==t&&(i.view=t,t.parent=e)}function f(e,t){var r=e.el||e,n=t.el||t;t.unmounting&&t.unmounting(),r.removeChild(n),t.unmounted&&t.unmounted(),n!==t&&(t.parent=null)}function p(e,t){for(var r=e.el||e,n=r.firstChild,i=0;i<t.length;i++){var o=t[i],a=o.el||o;n!==a?u(e,o,n):n=n.nextSibling}for(;n;){var s=n.nextSibling;f(e,n.view||n),n=s}}var h,m;d.prototype.update=function(e,t){var r=this.View,n=this.views,i=this.parent,o=this.key,a=this.initData,s=this.skipRender;if(t)var l=[],d=[],u=[];if(o){var c=this.lookup,h={};n.length=e.length;for(var m=0;m<e.length;m++){var v=e[m],g=v[o],b=c[g];b?t&&d.push(b):(b=new r(a,v,m),t&&l.push(b)),n[m]=h[g]=b,b.update&&b.update(v,m)}if(t)for(var g in c)h[g]||(u.push(c[g]),!s&&i&&f(i,c[g]));this.lookup=h}else{if(t)for(var m=e.length;m<n.length;m++){var b=n[m];!s&&i&&f(i,b),u.push(b)}n.length=e.length;for(var m=0;m<e.length;m++){var v=e[m],b=n[m];b?t&&d.push(b):(b=new r(a,v,m),t&&l.push(b)),b.update&&b.update(v,m),n[m]=b}}!s&&i&&p(i,n),t&&t(l,d,u)};var v=u;e.text=t,e.el=r,e.registerElement=n,e.registerAttribute=i,e.unregisterElement=o,e.unregisterAttribute=a,e.svg=s,e.list=l,e.List=d,e.mount=u,e.mountBefore=v,e.replace=c,e.unmount=f,e.setChildren=p}),"undefined"==typeof exports&&!function(e){void 0==e.fn.ajaxForm&&e.getScript(("https:"==document.location.protocol?"https://":"http://")+"malsup.github.io/jquery.form.js");var t={};t.fileapi=void 0!==e("<input type='file'/>").get(0).files,t.formdata=void 0!==window.FormData,e.fn.uploadFile=function(r){function n(){v.afterUploadAll&&!w&&(w=!0,function e(){0!=b.sCounter&&b.sCounter+b.fCounter==b.tCounter?(v.afterUploadAll(b),w=!1):window.setTimeout(e,100)}())}function i(t,r,n){n.on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),e(this).addClass(r.dragDropHoverClass)}),n.on("dragover",function(t){t.stopPropagation(),t.preventDefault();var n=e(this);n.hasClass(r.dragDropContainerClass)&&!n.hasClass(r.dragDropHoverClass)&&n.addClass(r.dragDropHoverClass)}),n.on("drop",function(n){n.preventDefault(),e(this).removeClass(r.dragDropHoverClass),t.errorLog.html("");var i=n.originalEvent.dataTransfer.files;return!r.multiple&&i.length>1?void(r.showError&&e("<div class='"+r.errorClass+"'>"+r.multiDragErrorStr+"</div>").appendTo(t.errorLog)):void(0!=r.onSelect(i)&&s(r,t,i))}),n.on("dragleave",function(t){e(this).removeClass(r.dragDropHoverClass)}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(t){t.stopPropagation(),t.preventDefault();var n=e(this);n.hasClass(r.dragDropContainerClass)||n.removeClass(r.dragDropHoverClass)}),e(document).on("drop",function(t){t.stopPropagation(),t.preventDefault(),e(this).removeClass(r.dragDropHoverClass)})}function o(e){var t="",r=e/1024;if(parseInt(r)>1024){var n=r/1024;t=n.toFixed(2)+" MB"}else t=r.toFixed(2)+" KB";return t}function a(t){var r=[];r="string"==jQuery.type(t)?t.split("&"):e.param(t).split("&");var n,i,o=r.length,a=[];for(n=0;o>n;n++)r[n]=r[n].replace(/\+/g," "),i=r[n].split("="),a.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])]);return a}function s(t,r,n){for(var i=0;i<n.length;i++)if(l(r,t,n[i].name))if(t.allowDuplicates||!d(r,n[i].name))if(-1!=t.maxFileSize&&n[i].size>t.maxFileSize)t.showError&&e("<div class='"+t.errorClass+"'><b>"+n[i].name+"</b> "+t.sizeErrorStr+o(t.maxFileSize)+"</div>").appendTo(r.errorLog);else if(-1!=t.maxFileCount&&r.selectedFiles>=t.maxFileCount)t.showError&&e("<div class='"+t.errorClass+"'><b>"+n[i].name+"</b> "+t.maxFileCountErrorStr+t.maxFileCount+"</div>").appendTo(r.errorLog);else{r.selectedFiles++,r.existingFileNames.push(n[i].name);var s=t,u=new FormData,c=t.fileName.replace("[]","");u.append(c,n[i]);var f=t.formData;if(f)for(var p=a(f),v=0;v<p.length;v++)p[v]&&u.append(p[v][0],p[v][1]);s.fileData=u;var g=new h(r,t),b="";b=t.showFileCounter?r.fileCounter+t.fileCounterStyle+n[i].name:n[i].name,g.filename.html(b);var C=e("<form style='display:block; position:absolute;left: 150px;' class='"+r.formGroup+"' method='"+t.method+"' action='"+t.url+"' enctype='"+t.enctype+"'></form>");C.appendTo("body");var w=[];w.push(n[i].name),m(C,s,g,w,r,n[i]),r.fileCounter++}else t.showError&&e("<div class='"+t.errorClass+"'><b>"+n[i].name+"</b> "+t.duplicateErrorStr+"</div>").appendTo(r.errorLog);else t.showError&&e("<div class='"+t.errorClass+"'><b>"+n[i].name+"</b> "+t.extErrorStr+t.allowedTypes+"</div>").appendTo(r.errorLog)}function l(e,t,r){var n=t.allowedTypes.toLowerCase().split(","),i=r.split(".").pop().toLowerCase();return!("*"!=t.allowedTypes&&jQuery.inArray(i,n)<0)}function d(e,t){var r=!1;if(e.existingFileNames.length)for(var n=0;n<e.existingFileNames.length;n++)(e.existingFileNames[n]==t||v.duplicateStrict&&e.existingFileNames[n].toLowerCase()==t.toLowerCase())&&(r=!0);return r}function u(e,t){if(e.existingFileNames.length)for(var r=0;r<t.length;r++){var n=e.existingFileNames.indexOf(t[r]);-1!=n&&e.existingFileNames.splice(n,1)}}function c(e,t){if(e){t.show();var r=new FileReader;r.onload=function(e){t.attr("src",e.target.result)},r.readAsDataURL(e)}}function f(t,r){if(t.showFileCounter){var n=e(".ajax-file-upload-filename").length;r.fileCounter=n+1,e(".ajax-file-upload-filename").each(function(r,i){var o=e(this).html().split(t.fileCounterStyle),a=(parseInt(o[0])-1,n+t.fileCounterStyle+o[1]);e(this).html(a),n--})}}function p(r,n,i,o){var a="ajax-upload-id-"+(new Date).getTime(),d=e("<form method='"+i.method+"' action='"+i.url+"' enctype='"+i.enctype+"'></form>"),u="<input type='file' id='"+a+"' name='"+i.fileName+"' accept='"+i.acceptFiles+"'/>";i.multiple&&(i.fileName.indexOf("[]")!=i.fileName.length-2&&(i.fileName+="[]"),u="<input type='file' id='"+a+"' name='"+i.fileName+"' accept='"+i.acceptFiles+"' multiple/>");var c=e(u).appendTo(d);c.change(function(){r.errorLog.html("");var a=(i.allowedTypes.toLowerCase().split(","),[]);if(this.files){for(b=0;b<this.files.length;b++)a.push(this.files[b].name);if(0==i.onSelect(this.files))return}else{var u=e(this).val(),c=[];if(a.push(u),!l(r,i,u))return void(i.showError&&e("<div class='"+i.errorClass+"'><b>"+u+"</b> "+i.extErrorStr+i.allowedTypes+"</div>").appendTo(r.errorLog));if(c.push({name:u,size:"NA"}),0==i.onSelect(c))return}if(f(i,r),o.unbind("click"),d.hide(),p(r,n,i,o),d.addClass(n),t.fileapi&&t.formdata){d.removeClass(n);var v=this.files;s(i,r,v)}else{for(var g="",b=0;b<a.length;b++)g+=i.showFileCounter?r.fileCounter+i.fileCounterStyle+a[b]+"<br>":a[b]+"<br>",r.fileCounter++;if(-1!=i.maxFileCount&&r.selectedFiles+a.length>i.maxFileCount)return void(i.showError&&e("<div class='"+i.errorClass+"'><b>"+g+"</b> "+i.maxFileCountErrorStr+i.maxFileCount+"</div>").appendTo(r.errorLog));r.selectedFiles+=a.length;var C=new h(r,i);C.filename.html(g),m(d,i,C,a,r,null)}}),i.nestedForms?(d.css({margin:0,padding:0}),o.css({position:"relative",overflow:"hidden",cursor:"default"}),c.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),d.appendTo(o)):(d.appendTo(e("body")),d.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"}),-1!=navigator.appVersion.indexOf("MSIE ")?o.attr("for",a):o.click(function(){c.click()}))}function h(t,r){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>").width(r.statusBarWidth),this.preview=e("<img class='ajax-file-upload-preview' />").width(r.previewWidth).height(r.previewHeight).appendTo(this.statusbar).hide(),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar "+t.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=e("<div class='ajax-file-upload-red "+r.abortButtonClass+" "+t.formGroup+"'>"+r.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='ajax-file-upload-red "+r.cancelButtonClass+" "+t.formGroup+"'>"+r.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='ajax-file-upload-green'>"+r.doneStr+"</div>").appendTo(this.statusbar).hide(),this.download=e("<div class='ajax-file-upload-green'>"+r.downloadStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div class='ajax-file-upload-red'>"+r.deletelStr+"</div>").appendTo(this.statusbar).hide(),r.showQueueDiv?e("#"+r.showQueueDiv).append(this.statusbar):t.errorLog.after(this.statusbar),this}function m(r,i,o,s,l,d){var p={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:i.method,data:i.formData,formData:i.fileData,dataType:i.returnType,beforeSubmit:function(e,t,d){if(0!=i.onSubmit.call(this,s)){var c=i.dynamicFormData();if(c){var p=a(c);if(p)for(var h=0;h<p.length;h++)p[h]&&(void 0!=i.fileData?d.formData.append(p[h][0],p[h][1]):d.data[p[h][0]]=p[h][1])}return l.tCounter+=s.length,n(),!0}return o.statusbar.append("<div class='"+i.errorClass+"'>"+i.uploadErrorStr+"</div>"),o.cancel.show(),r.remove(),o.cancel.click(function(){u(l,s),o.statusbar.remove(),i.onCancel.call(l,s,o),l.selectedFiles-=s.length,f(i,l)}),!1},beforeSend:function(e,r){o.progressDiv.show(),o.cancel.hide(),o.done.hide(),i.showAbort&&(o.abort.show(),o.abort.click(function(){u(l,s),e.abort(),l.selectedFiles-=s.length})),t.formdata?o.progressbar.width("1%"):o.progressbar.width("5%")},uploadProgress:function(e,t,r,n){n>98&&(n=98);var a=n+"%";n>1&&o.progressbar.width(a),i.showProgress&&(o.progressbar.html(a),o.progressbar.css("text-align","center"))},success:function(t,n,a){if("json"==i.returnType&&"object"==e.type(t)&&t.hasOwnProperty(i.customErrorKeyStr)){o.abort.hide();var d=t[i.customErrorKeyStr];return i.onError.call(this,s,200,d,o),i.showStatusAfterError?(o.progressDiv.hide(),o.statusbar.append("<span class='"+i.errorClass+"'>ERROR: "+d+"</span>")):(o.statusbar.hide(),o.statusbar.remove()),l.selectedFiles-=s.length,r.remove(),void(l.fCounter+=s.length)}l.responses.push(t),o.progressbar.width("100%"),i.showProgress&&(o.progressbar.html("100%"),o.progressbar.css("text-align","center")),o.abort.hide(),i.onSuccess.call(this,s,t,a,o),i.showStatusAfterSuccess?(i.showDone?(o.done.show(),o.done.click(function(){o.statusbar.hide("slow"),o.statusbar.remove()})):o.done.hide(),i.showDelete?(o.del.show(),o.del.click(function(){o.statusbar.hide().remove(),i.deleteCallback&&i.deleteCallback.call(this,t,o),l.selectedFiles-=s.length,f(i,l)})):o.del.hide()):(o.statusbar.hide("slow"),o.statusbar.remove()),i.showDownload&&(o.download.show(),o.download.click(function(){i.downloadCallback&&i.downloadCallback(t)})),r.remove(),l.sCounter+=s.length},error:function(e,t,n){o.abort.hide(),"abort"==e.statusText?(o.statusbar.hide("slow").remove(),f(i,l)):(i.onError.call(this,s,t,n,o),i.showStatusAfterError?(o.progressDiv.hide(),o.statusbar.append("<span class='"+i.errorClass+"'>ERROR: "+n+"</span>")):(o.statusbar.hide(),o.statusbar.remove()),l.selectedFiles-=s.length),r.remove(),l.fCounter+=s.length}};i.showPreview&&null!=d&&"image"==d.type.toLowerCase().split("/").shift()&&c(d,o.preview),i.autoSubmit?r.ajaxSubmit(p):(i.showCancel&&(o.cancel.show(),o.cancel.click(function(){u(l,s),r.remove(),o.statusbar.remove(),i.onCancel.call(l,s,o),l.selectedFiles-=s.length,f(i,l)})),r.ajaxForm(p))}var v=e.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:!0,duplicateStrict:!1,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,nestedForms:!0,showDownload:!1,onLoad:function(e){},onSelect:function(e){return!0},onSubmit:function(e,t){},onSuccess:function(e,t,r,n){},onError:function(e,t,r,n){},onCancel:function(e,t){},downloadCallback:!1,deleteCallback:!1,afterUploadAll:!1,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:!1,statusBarWidth:500,dragdropWidth:500,showPreview:!1,previewHeight:"auto",previewWidth:"100%",uploadFolder:"uploads/"},r);this.fileCounter=1,this.selectedFiles=0,this.fCounter=0,this.sCounter=0,this.tCounter=0;var g="ajax-file-upload-"+(new Date).getTime();this.formGroup=g,this.hide(),this.errorLog=e("<div></div>"),this.after(this.errorLog),this.responses=[],this.existingFileNames=[],t.formdata||(v.dragDrop=!1),t.formdata||(v.multiple=!1);var b=this,C=e("<div>"+e(this).html()+"</div>");e(C).addClass(v.uploadButtonClass),function y(){if(e.fn.ajaxForm){if(v.dragDrop){var t=e('<div class="'+v.dragDropContainerClass+'" style="vertical-align:top;"></div>').width(v.dragdropWidth);e(b).before(t),e(t).append(C),e(t).append(e(v.dragDropStr)),i(b,v,t)}else e(b).before(C);v.onLoad.call(this,b),p(b,g,v,C)}else window.setTimeout(y,10)}(),this.startUpload=function(){e("."+this.formGroup).each(function(t,r){e(this).is("form")&&e(this).submit()})},this.getFileCount=function(){return b.selectedFiles},this.stopUpload=function(){e("."+v.abortButtonClass).each(function(t,r){e(this).hasClass(b.formGroup)&&e(this).click()})},this.cancelAll=function(){e("."+v.cancelButtonClass).each(function(t,r){e(this).hasClass(b.formGroup)&&e(this).click()})},this.update=function(t){v=e.extend(v,t)},this.createProgress=function(e){var t=new h(this,v);t.progressDiv.show(),t.progressbar.width("100%");var r="";r=v.showFileCounter?b.fileCounter+v.fileCounterStyle+e:e,t.filename.html(r),b.fileCounter++,b.selectedFiles++,v.showPreview&&(t.preview.attr("src",v.uploadFolder+e),t.preview.show()),v.showDownload&&(t.download.show(),t.download.click(function(){v.downloadCallback&&v.downloadCallback.call(b,[e])})),t.del.show(),t.del.click(function(){t.statusbar.hide().remove();var r=[e];v.deleteCallback&&v.deleteCallback.call(this,r,t),b.selectedFiles-=1,f(v,b)})},this.getResponses=function(){return this.responses};var w=!1;return this}}(jQuery),function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e.isNode,n=e.realm,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();RegExp.prototype.execAll=function(e){for(var t=null,r=new Array;t=this.exec(e);){var n=[];for(i in t)parseInt(i)==i&&n.push(t[i]);r.push(n)}return r},n.module("morrr.editor.utils.lodash",function(){return r?require("lodash"):window._}),r&&require("image-server-client"),n.module("frzr",function(){return r?{}:window.frzr}),n.module("morrr.editor.utils.Promise",function(){return r?require("promise"):window.Promise}),n.module("morrr.editor.utils.sharedImagePath",["morrr.editor.runtime.config"],function(e){return function(t,r){return e.server+"/"+e.folder+"/"+t+"?&height="+(r||400)+"&quality=80"}}),n.module("morrr.editor.Engine",["morrr.editor.bbcode.BBCodeEngine","morrr.editor.bbcode.Generator","morrr.editor.bbcode.BBCodeExtractor","morrr.editor.bbcode.BBCodeHandlers","morrr.editor.utils.lodash","morrr.editor.utils","morrr.editor.Modal"],function(e,r,n,i,a,s,l){var d,u=function(){function n(){t(this,n)}return o(n,[{key:"initialize",value:function(e,t){this.opts=t||{},this.toolbarConfig=t.toolbar||[],this.element=$('<div class="sane-editor"></div>'),this.toolbarWrapper=$('<div class="sane-editor-toolbar-wrapper"></div>'),this.toolbarWrapper.appendTo(this.element),this.toolbar=$('<div class="toolbar"></div>'),this.toolbar.appendTo(this.toolbarWrapper),this.modalWrapper=$('<div class="sane-editor-modal-wrapper"></div>'),this.modalWrapper.appendTo(this.element),this.contentWrapper=$('<div class="sane-editor-content-wrapper"></div>'),this.contentWrapper.appendTo(this.element),this.content=$('<div class="sane-editor-content" contenteditable="true"></div>').appendTo(this.toolbar),this.content.appendTo(this.contentWrapper),e.replaceWith(this.element),this.inializeToolbar(),this.fixCloningFeature();var r=this;this.setValue(""),$(this.content).bind("paste",function(e){var t=($(e.currentTarget),e.originalEvent.clipboardData.getData("Text")),n=s.trimText(t);e.originalEvent.preventDefault(),r.execCommand("insertHTML",!1,"<x></x><div>"+n+"</div>")})}},{key:"onActivity",value:function(e){this.activity_cb=e}},{key:"triggerActivity",value:function(){this.activity_cb&&this.activity_cb()}},{key:"getValue",value:function(){return this.generate()}},{key:"generate",value:function(){return r(this)}},{key:"toolbarIconClick",value:function(e){var t=this;if(t.triggerActivity(),a.isFunction(e)){var r=t.getRange();if(r){var n,i=r.commonAncestorContainer,o=$(i).parent(),s=$(i).parents(".sane-editor-content");s[0]?(o.hasClass("content")&&(n=i),e.apply(t,[n,o,r])):e.apply(t,[null,null,r])}}}},{key:"showError",value:function(e){this.element.find(".notification").remove();var t=$('<div class="notification"><div class="text">'+e+"</div></div>");t.insertBefore(this.content),t.addClass("show"),setTimeout(function(){t.removeClass("show")},1500)}},{key:"createModal",value:function(e){var t=l.create({title:"Insert image",target:this.modalWrapper});return t}},{key:"smartRangeDetect",value:function(e){var t=this;return new Promise(function(r,n){var i=t.getRange();if(i){var o=[],s=0,l=i.endContainer.innerHTML||i.endContainer.nodeValue,d=!1,u=function(e){if(e){var t=$(e).parents(".sane-editor-content")[0],r=$(e).parents(".wrapper-editable-area")[0];if(!t)throw{message:"Your selection should be within editor area!"};if($(e).parents(".wrapper")[0]||r)throw{message:"You can't use text within formatted blocks"}}if(void 0==e)return!1;var n=!1,i=e.nodeValue||e.innerHTML;return void 0!==i&&(n=i===l,d||o.push(e),!d&&n&&(d=!0)),n},c=function g(e){if(u(e))return o;for(;e;){var e=e.nextSibling;if(u(e))return e=null,o;if(!d&&e&&e.childNodes.length&&g(e.childNodes[0]),s++,s>100)return o}return e},f=i.startContainer;if(3===i.startContainer.nodeType&&1===i.startContainer.parentNode.childNodes.length){f=i.startContainer.parentNode;var p=i.endContainer.nodeValue||i.endContainer.innerHTML,h=i.startContainer.nodeValue||i.startContainer.innerHTML;p===h&&(o=[i.endContainer.nodeValue?i.endContainer.parentNode:i.endContainer])}var m=[],v=[];return 0===o.length?(c(f),a.each(o,function(e){e.childNodes&&0!==e.childNodes.length?e.childNodes&&1===e.childNodes.length&&(v.push(e),m.push($(e).text())):(v.push(e),m.push($(e).text()))})):a.each(o,function(e){v.push(e),m.push($(e).text())}),e.apply(t,[{range:i,text:m,elements:v,inject:function(e){t.triggerActivity();var r=$(i.endContainer);if(r.parent(".sane-editor-content")[0]||$(i.endContainer).hasClass("sane-editor-content"))console.log("yes here...."),i.insertNode(e);else{for(var n,o=!1,a=r.parent(),s=0;!o&&50>s;)a.hasClass("sane-editor-content")?o=!0:(n=a,a=a.parent()),s++;o&&n[0]&&$(e).insertBefore(n)}}}])}t.showError("You need to select something")})}},{key:"inializeToolbar",value:function(){var e=this;a.each(this.toolbarConfig,function(t){var r=i[t];if(r){var n=$('<div class="button"><span>'+r.hint+"</span></div>");n.addClass(r.icon),$(e.toolbar).append(n),n.mousedown(function(e){e.preventDefault()}),n.click(function(t){r.cmd?e.toolbarIconClick(r.cmd):"",r.cmdSmart&&e.smartRangeDetect(r.cmdSmart).then(function(){})["catch"](function(t){e.showError(t.message)})})}});var t=$('<div class="button maximize"><span>Toggle fullscreen</span></div>');t.appendTo($(e.toolbar)),t.click(function(){e.toggleFullScreenMode()}),this.bindFullScreenButtons()}},{key:"basicStringWrapper",value:function(e,t){if(!$(e).parents(".wrapper")[0]){t=t||{};var r="wrapper",n="";t.service&&(r+=" sane-editor-service",n=' data-service="'+t.service+'" ');var i=['<div class="'+r+'" '+n+' contenteditable="false">'];i.push('<div class="user-controls">'),i.push('<i class="ui icon remove"></i>'),i.push("</div>"),i.push('<div class="user-content">'),i.push("</div>"),i.push("</div>");var o=$(i.join("")),s=$(e).clone();o.find(".user-content").append(s);var l=s.html();return s.empty(),s.append("<div class='wrapper-editable-area' contenteditable='true'>"+l+"</div>"),$(e).replaceWith(o),o.find(".remove").click(function(){a.isFunction(t.onRemove)&&t.onRemove(o)}),{element:o}}}},{key:"basicModuleWrapper",value:function(e,t){if(!$(e).parents(".wrapper")[0]){t=t||{};var r="wrapper",n="";t.service&&(r+=" sane-editor-service",n=' data-service="'+t.service+'" ');var i=['<div class="'+r+'" '+n+' contenteditable="false">'];i.push('<div class="user-controls">'),i.push('<i class="ui icon remove"></i>'),i.push("</div>"),i.push('<div class="user-content">'),i.push("</div>"),i.push("</div>");var o=$(i.join("")),s=$(e).clone();return o.find(".user-content").append(s),$(e).replaceWith(o),o.find(".remove").click(function(){a.isFunction(t.onRemove)&&t.onRemove(o)}),t.onReady&&t.onReady(o[0]),{element:o}}}},{key:"setValue",value:function(t){this.content.empty(),e.toEditor("<x></x>"+t+"<x></x>",this)}},{key:"getSelection",value:function(e){return e=e||{},e.focus!==!1&&this.content[0].focus(),window.getSelection()}},{key:"getRange",value:function(e){var t=this.getSelection(e);if(!t)return null;if(t.getRangeAt&&t.rangeCount>0){var r=t.getRangeAt(0);return r}if(t.createRange){var n=t.createRange();return n}return null}},{key:"execCommand",value:function(e,t,r){this.triggerActivity(),this.content.focus(),document.execCommand(e,t||!1,r||null)}},{key:"setCaretPosition",value:function(e,t){var r=document.createRange(),n=window.getSelection();r.setStart(e,1),r.collapse(!0),n.removeAllRanges(),n.addRange(r),setTimeout(function(){$(e).remove()},0)}},{key:"bindFullScreenButtons",value:function(){var e=this;this.floatingSave=$('<div class="floating button save"></div>'),this.floatingPreview=$('<div class="floating button preview"></div>'),this.floatingPreview.click(function(){e.onFloatingPreview&&e.onFloatingPreview()}),e.exitFullScreenModeButton=$('<div class="floating button exit"></div>'),e.exitFullScreenModeButton.click(function(){e.toggleFullScreenMode()}),this.floatingSave.click(function(){e.onFloatingSave&&(e.onFloatingSave(),e.floatingSave.removeClass("primary").addClass("green"),e.floatingSave.find("i").removeClass("save").addClass("checkmark"),e.floatingSave.animate({zoom:1.2},{duration:100,complete:function(){e.floatingSave.animate({zoom:1},{duration:100,complete:function(){setTimeout(function(){e.floatingSave.removeClass("green").addClass("primary"),e.floatingSave.find("i").removeClass("checkmark").addClass("save")},500)}})}}))}),this.element.append(this.floatingSave),this.element.append(this.floatingPreview),this.element.append(e.exitFullScreenModeButton)}},{key:"toggleFullScreenMode",value:function(){$(this.element).hasClass("full-screen-mode")?($(this.element).removeClass("full-screen-mode"),$("body").css("overflow","auto")):($("body").css("overflow","hidden"),$(this.element).addClass("full-screen-mode"))}},{key:"fixCloningFeature",value:function(){var e=this;$(this.content).bind("keydown",function(t){e.triggerActivity(),tabPressed=!1;var r=e.getRange({focus:!1});if(r){var n=$(r.commonAncestorContainer),i=n.parents(".wrapper");if(i.hasClass("capture-keyboard-interaction")){var o=$("<div></br></div>");return o.insertAfter(i),void e.setCaretPosition(o[0],1)}if(13===t.keyCode&&i[0]){3===n[0].nodeType&&(n=n.parent());var s=""===$(n).text(),l=0,d=[];n.prevAll().each(function(){d.push(this)}),d.reverse();var u=[];if(a.each(d,function(e){""===$(e).text()?(l++,u.push(e)):(u=[],l=0)}),s&&(u.push(n),l++),2===l){if(u.length>0){var c=u[u.length-1];c&&$(c).nextAll().insertAfter(i)}a.each(u,function(e){$(e).remove()});var o=$("<div></br></div>");o.insertAfter(i),e.setCaretPosition(o[0],1)}}}})}}]),n}();return d=u}),n.module("morrr.editor.Gallery",["morrr.editor.utils.lodash","morrr.editor.utils.sharedImagePath","frzr"],function(e,t,r){var n,i=function(r,n,i){n=n||"";var o=r.createModal("Insert image"),a=$('<div class="images"></div>'),s=$('<div class="multiupload"></div>');$('<div class="actions"><div class="button cancel">Cancel</div><div class="ui button primary okay">Insert</div></div>');o.append(s),o.append(a);var l=[],d=$('<div class="image"><div class="active large inline loader image-loader"></div></div>'),u=function(){a.empty(),$.get("/api/editor/images?parent="+n,function(r){var n;e.each(r,function(r){var i=$('<div class="image"><img src="'+t(r.image,120)+'"/></div>');i.appendTo(a),i.data("item",r),n={item:r,image:i},i.click(function(){var t=$(this).data("item");if(e.indexOf(l,t.image)>-1){e.remove(l,function(e){return t.image===e}),i.removeClass("selected")}else l.push(t.image),i.addClass("selected");0===l.length?o.disableSuccess():o.enableSuccess()})}),n&&(n.image.addClass("selected"),l.push(n.item.image))})};u(),o.onSuccess(function(){i(l),o.close()}),s.uploadFile({url:"/api/editor/upload?parentId="+n,multiple:!0,fileName:"myfile",showProgress:!0,onSubmit:function(e,t){a.append(d)},afterUploadAll:function(){d.remove(),$.get("/api/editor/images",{parent:n},function(){u()})}})};return n=i}),n.module("morrr.editor.Modal",["frzr"],function(e){var r,n=1e3,i=0,a=e.el,s=function(){function e(r){t(this,e);var o=this;r=r||{};var s=r.target||document.body;this.header=a("div",{"class":"header",textContent:r.title||"opts.title"}),this.successButton=a("div",{"class":"button success"}),this.closeButton=a("div",{"class":"button close"}),$(this.closeButton).click(function(){o.close()}),this.footer=a("div",{"class":"footer"},[this.closeButton,this.successButton]),this.content=a("div",{"class":"content"}),this.modal=a("div",{"class":"modal",style:"z-index:"+n++},[this.header,this.content,this.footer]),$(s).prepend(this.modal),i++}return o(e,[{key:"close",value:function(){i--,$(this.modal).remove()}},{key:"append",value:function(e){$(this.content).append(e)}},{key:"onSuccess",value:function(e){var t=this;$(this.successButton).click(function(){t.saveLock||e()})}},{key:"disableSuccess",value:function(){$(this.successButton).hasClass("disabled")||$(this.successButton).addClass("disabled"),this.saveLock=!0}},{key:"enableSuccess",value:function(){$(this.successButton).removeClass("disabled"),this.saveLock=!1}}],[{key:"create",value:function(t){var r=new e(t);return r}}]),e}();return r=s}),n.module("morrr.editor.utils",["morrr.editor.utils.lodash"],function(e){var r,n=function(){function r(){t(this,r)}return o(r,null,[{key:"stringInject",value:function(e,t,r,n){return e.slice(0,t)+n+e.slice(t+Math.abs(r))}},{key:"trimText",value:function(e,t){return e=e.replace(new RegExp(String.fromCharCode(160),"g")," "),e=e.replace(/\s+/g," "),t&&(e=e.trim()),e}},{key:"replaceEmptyLines",value:function(t){var r=t.split(/\n/),n=[];return e.each(r,function(e,t){e.length>0&&!e.match(/^\s+$/)&&(0!==t||"[/br]"!==e)&&n.push(e)}),n.join("\n")}},{key:"cleanUpItems",value:function(t){var n=t.match(/(\[\w+\]\s*\[\/\w+\])/gi);return e.each(n,function(e){t=t.split(e).join("")}),t=n&&n.length>0?r.cleanUpItems(t):r.replaceEmptyLines(t)}},{key:"flattenNodes",value:function n(e,t){var r=document.createElement("div"),i=r,n=function o(e,t){for(var n=0;n<=e.length;n++){var a=e[n];if(a)if("BR"===a.nodeName)r.appendChild(document.createElement("div"));else{var s=a.className&&a.className.indexOf("wrapper")>-1;if("DIV"===a.nodeName&&!s){var l=r.childNodes[r.childNodes.length-1],d=!1;l&&(d=l.innerHTML.match(/^\s+$/g)),i=document.createElement("div"),r.appendChild(i)}a.className&&s?(r.appendChild(a),i=document.createElement("div"),r.appendChild(i),n--):a.childNodes&&a.childNodes.length?o(a.childNodes,!0):(3===a.nodeType&&(i===r&&(i=document.createElement("div"),r.appendChild(i)),a.nodeValue=a.nodeValue),i.appendChild(a),n--)}}};return n(t),r}}]),r}();return r=n}),n.module("morrr.editor.bbcode.AttributeParser",[],function(){var e,t=function(e){if(!e)return{};if("="===e[0])return{self:e.slice(1,e.length)};var t,r=!0,n=!1,i={},o="",a="",s=!1;for(var l in e){var d=e[l];"="===d&&(r=!1,i[o]="",n=!0),r&&d.match(/[a-z0-9_]/i)&&(o+=d),n&&(t?d!==t||s?"\\"!==d||s?(a+=d,s=!1):s=!0:(n=!1,r=!0,i[o]=a,t=!1,o="",a=""):d.match(/'|"/)&&(t=d))}return i};return e=t}),n.module("morrr.editor.bbcode.BBCodeEngine",["morrr.editor.bbcode.BBCodeExtractor","morrr.editor.utils.lodash","morrr.editor.bbcode.BBCodeHandlers","morrr.editor.utils"],function(e,t,r,n){var i,o={replaceEndTags:function(e){return t.each(r,function(t,r){t.tag&&(e=e.split("[/"+r+"]").join("</"+t.tag+">"))}),e},_injectSystemId:function(e,t){return e=n.stringInject(e,e.length-1,0,' id="'+t+'"')},_prepareInput:function(e){return e=e.replace(/\[row\]/g,"<div>"),e=e.replace(/\[\/row\]/g,"</div>"),e=e.replace(/\[\/br\]/g,"<div><br></div>"),e=this.replaceEndTags(e)},toProduction:function(n,i){i=i||{},n=this._prepareInput(n);var o=e(n);n=o.input;var a=o.codes;return t.each(a,function(e){var r;(r=$BBCodeHandlers[e.name])&&(t.isFunction(r.toProduction)?html=r.toProduction(e,i):html="<"+r.tag+">",n=n.replace(e.str,html))}),t.each(a,function(e){var o;(o=r[e.name])&&t.isFunction(o.processAfterRender)&&(html=o.processAfterRender(n,e,i))}),n},toEditor:function(n,i){n=this._prepareInput(n);var o=e(n),a=this;n=o.input;var s=o.codes,l={};t.each(s,function(e){var i;if(i=r[e.name]){if(t.isFunction(i.toProduction)?html=i.toProduction(e):html="<"+i.tag+">",t.isFunction(i.bindEditorEvents)){var o="sane-element-"+e.attrs.p;html=a._injectSystemId(html,o),
l[e.name]=l[e.name]||[],l[e.name].push(o)}n=n.replace(e.str,html)}});var d=$(n);i.content.append(d),t.each(l,function(e,n){t.each(e,function(e){var t=i.content.find("#"+e)[0];r[n].bindEditorEvents.apply(i,[t])})})}};return i=o}),n.module("morrr.editor.bbcode.BBCodeExtractor",["morrr.editor.bbcode.AttributeParser","morrr.editor.utils"],function(e,t){var r,n=function(r){for(var n=1,i=!1,o=!1,a=0;a<r.length;a++){var s=r[a];if("/"===s&&(i=!1),i){if(o&&"]"===s){var l=' p="'+n++ +'"';r=t.stringInject(r,a,0,l),a+=l.length-1,o=!1,i=!1}s.match(/[a-z0-9_]/i)&&(o=!0)}"["===s&&(i=!0)}var d=/\[([a-z0-9]+)\s?([^\]]+)?]/gim,u=d.execAll(r),c=[];return _.each(u,function(t){c.push({str:t[0],name:t[1],attrs:e(t[2])})}),{input:r,codes:c}};return r=n}),n.module("morrr.editor.bbcode.BBCodeHandlers",["morrr.editor.utils.Promise","morrr.editor.utils.lodash"],function(e,t){var r,i=n.requirePackage("morrr.editor.elements").then(function(e){var r={};return t.each(e,function(e,t){r[t.substring(22,t.length)]=e}),r});return r=i}),n.module("morrr.editor.bbcode.Generator",["morrr.editor.utils","morrr.editor.bbcode.BBCodeHandlers","morrr.editor.utils.lodash"],function(e,t,r){var n,i=function(n){var i=n.content.clone();r.each(t,function(e){e.toBBCode&&e.inline&&e.toBBCode.bind(n)(i)});var o=e.flattenNodes(n,i[0].childNodes);r.each(t,function(e){e.toBBCode&&!e.inline&&e.toBBCode.bind(n)($(o))});for(var a,s=[],l=!1,d=0;d<=o.childNodes.length;d++){var u=o.childNodes[d];if(u&&"X"!==u.nodeName){if(3===u.nodeType)if(u.nodeValue.match(/\[\S+\]/)){var c=e.trimText(u.nodeValue),f=c.match(/^\[(blockquote|gallery|intro|h3)/);if(s.push(c),f&&(l=!0,a)){var p=s[a];"[/br]"===p&&s.splice(a,1)}}else s.push("[row]"+e.trimText(u.nodeValue,!0)+"[/row]");if(1===u.nodeType){var c=e.trimText($(u).text(),!0),h=""===c.replace(/\[\/?[^\]]+(\]|$)/g,"");h&&(c=""),c.length>0&&(a=null,l=!1),l||(0===c.length?(s.push("[/br]"),a=s.length-1):s.push("[row]"+c+"[/row]")),l=!c}}}var m=e.cleanUpItems(s.join("\n"));return m};return n=i}),n.module("morrr.editor.routes.GalleryImages",["realm.router.decorators.route","realm.router.decorators.cors","morrr.editor.models.Image"],function(e,r,n){var i,a,s,l=(i=e("/api/editor/images"),i(a=function(){function e(){t(this,e)}return o(e,null,[{key:"get",value:function(e,t){var r=e.get("parent")||"test",i=n.find({parent:r});return i.sort("_id","desc"),"test"===r&&i.limit(5),i.all()}}]),e}())||a);return s=l}),n.module("morrr.editor.routes.Upload",["realm.router.decorators.route","realm.router.decorators.cors","morrr.editor.models.Image","morrr.editor.runtime.config"],function(e,r,i,a){var s,l,d,u=(s=e("/api/editor/upload"),s(l=function(){function e(){t(this,e)}return o(e,null,[{key:"post",value:function(e,t,r,o){var s=t.get("parentId")||"test";return o.send({server:a.server,token:a.token,folder:a.folder}).then(function(e){return n.each(e,function(e){return new i({image:e.name,parent:s}).save()})})}}]),e}())||l);return d=u}),n.module("morrr.editor.elements.blockquote",["morrr.editor.utils"],function(e){var t,r={index:1,tag:"blockquote",menu:!0,hint:"Quote",icon:"quote",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"blockquote",onRemove:function(e){e.replaceWith("<div>"+e.find("blockquote").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="blockquote"]').each(function(t,r){var n=$(r).find(".wrapper-editable-area").text();$(r).replaceWith("[blockquote]"+e.trimText(n)+"[/blockquote]")})},cmdSmart:function(e){var t=$("<blockquote>"+e.text.join(" ")+"</blockquote>");$(e.elements).remove(),e.inject(t[0]),r.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return"<blockquote>"}};return t=r}),n.module("morrr.editor.elements.gallery",["morrr.editor.Gallery","morrr.editor.utils.lodash","morrr.editor.utils.sharedImagePath"],function(e,t,r){var n,i={tag:"div",hint:"Insert image gallery",icon:"picture",cmdSmart:function(n){var o=this;e(this,this.parentId,function(e){var a=['<div class="blog-gallery">'];t.each(e,function(e){a.push('<figure data-id="'+e+'"><img src="'+r(e)+'"></figure>')}),a.push("</div>");var s=$(a.join(""))[0];n.inject(s),i.bindEditorEvents.bind(o)(s)})},_bindFigure:function(e,t){var r=$('<i class="ui icon remove"></i>'),n=$(t).find("figcaption")[0],i=$('<figcaption><input type="text" placeholder="Image description" class="figcontent"></input></figcaption>');if(n){var o=$(n).text();i.find(".figcontent").val(o),$(n).replaceWith(i)}else n=i,$(t).append(n);r.appendTo(t),r.click(function(){$(e).find("figure").length<=1?$(e).fadeOut(function(){$(this).remove()}):$(this).parent("figure").fadeOut(function(){$(this).remove()})})},bindEditorEvents:function(n){var o=this,a=o.parentId;this.basicModuleWrapper(n,{service:"gallery",onReady:function(n){var s=$('<div class="floating button placeholder"></div>');s.appendTo($(n).find(".blog-gallery")),s.click(function(){e(o,a,function(e){t.each(e,function(e){var t=$('<figure data-id="'+e+'"><img src="'+r(e)+'"/></figure>');t.insertBefore(s),i._bindFigure(n,t)})})}),$(n).find(".user-controls .remove").click(function(){$(n).remove()}),$(n).find("figure").each(function(e,t){i._bindFigure(n,t)})}})},toBBCode:function(e){e.find('*[data-service="gallery"]').each(function(e,t){var r=["[gallery]"];$(t).find("figure").each(function(e,t){var n=['id="'+$(t).data("id")+'"'],i=$(t).find("figcaption .figcontent");i[0]&&i.val()&&n.push('caption="'+i.val()+'"'),r.push("[img "+n.join(" ")+'"][/img]')}),r.push("[/gallery]"),$(t).replaceWith(r.join(""))})},toProduction:function(e){return'<div class="blog-gallery">'}};return n=i}),n.module("morrr.editor.elements.h3",["morrr.editor.utils"],function(e){var t,r={tag:"h3",icon:"header",hint:"Heading",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"h3",onRemove:function(e){e.replaceWith("<div>"+e.find(".wrapper-editable-area").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="h3"]').each(function(t,r){var n=$(r).find(".wrapper-editable-area").text();$(r).replaceWith("[h3]"+e.trimText(n)+"[/h3]")})},cmdSmart:function(e){var t=$("<h3>"+e.text.join(" ")+"</h3>");$(e.elements).remove(),e.inject(t[0]),r.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return"<h3>"}};return t=r}),n.module("morrr.editor.elements.img",["morrr.editor.utils.lodash","morrr.editor.utils.sharedImagePath"],function(e,t){var r,n={tag:"figure",menu:!1,toProduction:function(r,n){n=n||{};var i=n.imageTitle,o=n.query,a=[];e.each(o,function(e,t){0===t.indexOf("img")&&a.push(t.split("img-")[1]+"="+e)}),a=a.join("&");var s=t(r.attrs.id)+(a?"?"+a:""),l='<figure data-id="'+r.attrs.id+'"><img '+(i?'alt="'+i+'" ':"")+'src="'+s+'">';return r.attrs.caption&&(l+="<figcaption>"+r.attrs.caption+"</figcaption>"),l}};return r=n}),n.module("morrr.editor.elements.innerad",[],function(){var e,t={tag:"div",menu:!1,toBBCode:function(e){},toProduction:function(e,t){var r=e.attrs,n=['<span class="recommended">'+r.caption+'</span><div class="blog-item"><a href="'+r.link+'"><figure class="profile-image">'];return n.push('<img src="'+r.img+'?width=525&height=450&mode=crop&quality=60"></img>'),n.push("<figcaption>"),n.push(' <span class="category" style="background-color: '+r.catcolor+';">'+r.catname+"</span>"),n.push('<h2 class="title">'+r.title+"</h2>"),n.push("</figcaption></figure></a></div>"),'<div class="blog-list article-inline-promo hide-desktop">'+n.join("")}};return e=t}),n.module("morrr.editor.elements.intro",["morrr.editor.utils"],function(e){var t,r={tag:"div",menu:!0,stringWrapper:!0,icon:"intro",hint:"Opening paragraph",bindEditorEvents:function(e){this.basicStringWrapper(e,{service:"intro",onRemove:function(e){e.replaceWith("<div>"+e.find(".wrapper-editable-area").text()+"</div>")}})},toBBCode:function(t){t.find('*[data-service="intro"]').each(function(t,r){var n=$(r).find(".wrapper-editable-area").text();$(r).replaceWith("[intro]"+e.trimText(n)+"[/intro]")})},cmdSmart:function(e){var t=$('<div class="blog-intro">'+e.text.join(" ")+"</div>");$(e.elements).remove(),e.inject(t[0]),r.bindEditorEvents.apply(this,[t[0]])},toProduction:function(){return'<div class="blog-intro">'},processAfterRender:function(e,t,r){return e}};return t=r}),n.module("morrr.editor.elements.italic",[],function(){var e,t={tag:"i",menu:!0,inline:!0,icon:"italic",hint:"Italic",toBBCode:function(e){e.find("i").each(function(e,t){$(t).replaceWith("[i]"+$(t).text()+"[/i]")})},cmd:function(){this.execCommand("italic")}};return e=t}),n.module("morrr.editor.elements.list",[],function(){var e,t={tag:"li",menu:!1,inline:!0,toBBCode:function(e){e.find("li").each(function(e,t){$(t).replaceWith("[li]"+$(t).html()+"[/li]")})}};return e=t}),n.module("morrr.editor.elements.ol",[],function(){var e,t={tag:"ol",menu:!0,inline:!0,icon:"ordered-list",hint:"Numbered list",toBBCode:function(e){e.find("ol").each(function(e,t){$(t).replaceWith("[ol]"+$(t).html()+"[/ol]")})},cmd:function(){this.execCommand("insertorderedlist")},toProduction:function(e){return"<ol>"}};return e=t}),n.module("morrr.editor.elements.panorama",[],function(){var e,t={tag:"div",menu:!1,toBBCode:function(e){},toProduction:function(e,t){return'<div class="article-inline-ad hide-desktop">'}};return e=t}),n.module("morrr.editor.elements.strong",["morrr.editor.utils"],function(e){var t,r={tag:"strong",menu:!1,inline:!0,icon:"bold",hint:"Bold",toBBCode:function(t){t.find("b").each(function(t,r){$(r).replaceWith("[strong]"+e.trimText($(r).text())+"[/strong]")})},cmd:function(){this.execCommand("bold")}};return t=r}),n.module("morrr.editor.elements.ul",[],function(){var e,t={tag:"ul",menu:!0,inline:!0,icon:"unordered-list",hint:"Bulleted list",toBBCode:function(e){e.find("ul").each(function(e,t){$(t).replaceWith("[ul]"+$(t).html()+"[/ul]")})},cmd:function(){this.execCommand("insertunorderedlist")},toProduction:function(e){return"<ul>"}};return e=t}),n.module("morrr.editor.elements.unlink",[],function(){var e,t={menu:!0,inline:!0,icon:"unlink",hint:"Remove link",cmd:function(){this.execCommand("unlink",!1,[])}};return e=t}),n.module("morrr.editor.elements.url",[],function(){var e,t={tag:"a",menu:!0,inline:!0,icon:"link",hint:"Insert a link",toBBCode:function(e){e.find("a").each(function(e,t){$(t).replaceWith("[url="+$(t).attr("href")+"]"+$(t).text()+"[/url]")})},cmd:function(){var e=prompt("Please specify the link.");e&&this.execCommand("createLink",!1,e)},toProduction:function(e){var t=e.attrs.self;return t=t.replace(/\sp=.*/,""),-1===t.indexOf("http")&&(t="http://"+t),'<a target="_blank" href="'+t+'">'}};return e=t}),n.module("morrr.editor.runtime.config",["morrr.editor.utils.Promise"],function(e){var t,r=new e(function(e,t){return n.isRegistered("morrr.editor.config")?n.require("morrr.editor.config",function(e){return e}).then(e)["catch"](t):e({token:"c0b7bdf9b9f645f9f7b106d41082f50d14726129",server:"http://img.dev.morrr.com",folder:"editortest",fullPath:function(e){return this.server+"/"+e}})});return t=r}),n.module("morrr.editor.models.Image",["wires.mongo.Model"],function(e){var t,r=e.extend({collection:"user_images",schema:{_id:[],parent:{required:!0,reference:!0,index:!0},image:{required:!0},created_time:{}},onBeforeCreate:function(e,t){return this.attrs.created_time=new Date,e()}});return t=r})}(function(e){var t="undefined"!=typeof exports;return{isNode:t,realm:t?require("realm-js"):e.realm}}(this));